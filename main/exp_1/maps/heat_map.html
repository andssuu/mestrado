<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mapa de Calor</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #floating-panel {
        position: absolute;
        top: 10px;
        left: 5%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
      #floating-panel {
        background-color: #fff;
        border: 1px solid #999;
        left: 5%;
        padding: 5px;
        position: absolute;
        top: 10px;
        z-index: 5;
      }
    </style>
  </head>

  <body>
    <div id="floating-panel">
      <button onclick="toggleHeatmap()">Toggle Heatmap</button>
      <button onclick="changeGradient()">Change gradient</button>
      <button onclick="changeRadius()">Change radius</button>
      <button onclick="changeOpacity()">Change opacity</button>
      <br>
      <button onclick="changeHeatmap(0, 24)">0-24</button>
      <button onclick="changeHeatmap(0, 1)">0-1</button>
      <button onclick="changeHeatmap(1, 2)">1-2</button>
      <button onclick="changeHeatmap(2, 3)">2-3</button>
      <button onclick="changeHeatmap(3, 4)">3-4</button>
      <button onclick="changeHeatmap(4, 5)">4-5</button>
      <button onclick="changeHeatmap(5, 6)">5-6</button>
      <button onclick="changeHeatmap(6, 7)">6-7</button>
      <button onclick="changeHeatmap(7, 8)">7-8</button>
      <button onclick="changeHeatmap(8, 9)">8-9</button>
      <button onclick="changeHeatmap(9, 10)">9-10</button>
      <button onclick="changeHeatmap(10, 11)">10-11</button>
      <button onclick="changeHeatmap(11, 12)">11-12</button>
      <button onclick="changeHeatmap(12, 13)">12-13</button>
      <button onclick="changeHeatmap(13, 14)">13-14</button>
      <button onclick="changeHeatmap(14, 15)">14-15</button>
      <button onclick="changeHeatmap(15, 16)">15-16</button>
      <button onclick="changeHeatmap(16, 17)">16-17</button>
      <button onclick="changeHeatmap(17, 18)">17-18</button>
      <button onclick="changeHeatmap(18, 19)">18-19</button>
      <button onclick="changeHeatmap(19, 20)">19-20</button>
      <button onclick="changeHeatmap(20, 21)">20-21</button>
      <button onclick="changeHeatmap(21, 22)">21-22</button>
      <button onclick="changeHeatmap(22, 23)">22-23</button>
      <button onclick="changeHeatmap(23, 24)">23-24</button>
    </div>
    <div id="map"></div>
    <!-- <script type="text/javascript" src="../../../data/exp_1/cow_1.json"></script>
    <script type="text/javascript" src="../../../data/exp_1/cow_2.json"></script>
    <script type="text/javascript" src="../../../data/exp_1/cow_3.json"></script> -->
    <script type="text/javascript" src="../../../data/exp_1/chuviscada.json"></script>
 <script>
      // This example requires the Visualization library. Include the libraries=visualization
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization">
      var map, heatmap;
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 18,
            center: {lat: -8.975696, lng: -36.454287},
            mapTypeId: 'satellite'
          });
          heatmap = new google.maps.visualization.HeatmapLayer({
            data: getPoints(0, 24),
            map: map
          });
      }

      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

      function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
      }

      function changeRadius() {
        heatmap.set('radius', heatmap.get('radius') ? null : 20);
      }

      function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
      }

      function changeHeatmap(t_min, t_max) {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 18,
            center: {lat: -8.975696, lng: -36.454287},
            mapTypeId: 'satellite'
          });
          heatmap = new google.maps.visualization.HeatmapLayer({
            data: getPoints(t_min, t_max),
            map: map
          });
      }

      function getPoints(t_min, t_max) {
        var data = chuviscada
        var markers = []
        //1565233200000 -> day 8/8/19 - 0h - UTC-3
        threshold_min = 1565233200000 + (3600000 * t_min)
        threshold_max = 1565233200000 + (3600000 * t_max)
        for (n in data) {
          var ts = parseInt(data[n].ts)
          if (ts >threshold_min &&  ts <threshold_max){
            markers.push(new google.maps.LatLng(data[n].lat, data[n].lng))
          }
        };
        return markers;
      }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFKwUvNG5SBvqlaMteDW7EEOWK2hRZc8o&libraries=visualization&callback=initMap">
    </script>
  </body>
</html>